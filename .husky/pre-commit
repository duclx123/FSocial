#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Running test quality checks..."

# Check if we're in Lambda directory and run Lambda-specific checks
if [ -d "lambda" ]; then
  echo "ğŸ“¦ Checking Lambda tests..."
  cd lambda
  
  # Run test linting
  npm run lint:test
  if [ $? -ne 0 ]; then
    echo "âŒ Lambda test linting failed"
    exit 1
  fi
  
  # Run tests to ensure they pass
  npm run test
  if [ $? -ne 0 ]; then
    echo "âŒ Lambda tests failed"
    exit 1
  fi
  
  # Check coverage thresholds
  npm run test:coverage
  if [ $? -ne 0 ]; then
    echo "âŒ Lambda coverage thresholds not met"
    exit 1
  fi
  
  cd ..
fi

# Check if we're in Frontend directory and run Frontend-specific checks
if [ -d "frontend" ]; then
  echo "ğŸ¨ Checking Frontend tests..."
  cd frontend
  
  # Run test linting
  npm run lint:test
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend test linting failed"
    exit 1
  fi
  
  # Run tests to ensure they pass
  npm run test
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend tests failed"
    exit 1
  fi
  
  # Check coverage thresholds
  npm run test:coverage
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend coverage thresholds not met"
    exit 1
  fi
  
  cd ..
fi

echo "âœ… All test quality checks passed!"